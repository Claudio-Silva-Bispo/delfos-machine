
# Projeto

# Nossa solução

## Prevenir é CUIDAR: Cliente SEGURO, Parceiro RENTÁVEL.

Essa frase reflete o foco na prevenção para garantir a saúde do cliente, ao mesmo tempo em que destaca o impacto positivo nos parceiros (clínicas), trazendo mais eficiência e redução de custos. cliente na rua, é um cliente seguro e com saúde.
Falamos na rua, pois queremos atender 100% da carteira de cliente, para que todos façam consultas preventivas, evitando e previnindo 
consultas emegências, que podem acarretar altos custos.

## Objetivo

Nosso objetivo é reduzir os altos custos de sinistros, sem evitar consultas, mas sim prevenindo consultas de valores elevados e fora do comum.  Ao incentivar consultas preventivas, economizaremos recursos e diminuiremos a necessidade de atendimentos emergenciais.

Nosso modelo vai sugerir consultas ao cliente com base em suas preferências de atendimento, como local, data, horário, com especialistas que possuem qualidade acima de nota 4 e com custos baixos. Iremos treinar a IA para procurar o cliente primeiro, 
ao invés de esperar que ele nos procure com problemas maiores.

Por exemplo, se uma pessoa realiza limpezas e radiografias ósseas a cada 5 ou 6 meses, pode evitar extrações devido a cuidados bucais inadequados, que podem custar cerca de dois mil reais. Em nosso cenário, esse valor é extremamente alto. É mais vantajoso cobrir uma consulta de 200 reais, que representa apenas 10% do custo de um procedimento emergencial.

Além disso, vamos atender as clínicas e parceiros, levando mais clientes e aumentando sua carteira.

## Objetivos específicos

1. Reduz custos de sinistros: A solução ajuda a identificar clientes que podem precisar de cuidados preventivos e sugere consultas personalizadas, evitando o surgimento de problemas maiores e mais caros.

2. Automatiza a prevenção: Ao usar IA para sugerir consultas preventivas com base nas preferências dos clientes, o sistema evita a espera passiva por problemas emergenciais e passa a atuar de forma proativa, ajudando Mariana a controlar melhor os gastos.

3. Garante atendimento de qualidade: A solução só sugere especialistas com notas acima de 4 e custos mais baixos, mantendo a satisfação dos clientes e garantindo cuidados de qualidade.

4. Fortalece a rede de parceiros: Além de beneficiar os clientes, a solução leva mais pacientes para as clínicas parceiras, o que ajuda a aumentar a receita dessas instituições, mantendo-as engajadas com a operadora.

## Persona
**Essa situação vai explicar exatamente o que queremos e porque desejamos criar esssa solução**

**Persona**
Persona: Claudio Delfos
Idade: 30 anos
Profissão: Desenvolvedor de software e estudante
Localização: São Paulo, SP
Perfil: Ativo, trabalha em período integral e estuda à noite, além de participar de projetos extracurriculares em tecnologia
Tempo de Convênio: 10 meses

**Sobre Claudio**
Claudio tem uma vida corrida, dividindo seu tempo entre o trabalho, os estudos e projetos pessoais. Ele valoriza muito a conveniência e eficiência em qualquer serviço que utilize, pois seu tempo livre é bastante limitado. Embora ele tenha um plano de saúde, não costuma usá-lo para consultas preventivas. Nos últimos dois meses, começou a sentir dores ao mastigar, mas nada que pareça sério o suficiente para levá-lo a marcar uma consulta por conta própria.

**Desafios e Frustrações**

***Falta de tempo para marcar consultas***

Claudio tem uma rotina apertada e acha difícil encontrar tempo para agendar e ir a consultas médicas, principalmente porque considera incômoda a necessidade de organizar essas visitas em meio a sua agenda já cheia.

***Problemas ignorados por falta de urgência*** 

Mesmo com um plano de saúde, Claudio evita ir ao médico até que o problema se torne mais sério, pois não quer perder tempo com consultas que julga desnecessárias no momento.

***Preocupação com a qualidade do atendimento*** 

Quando Claudio finalmente decide ir a uma consulta, ele se preocupa em encontrar um bom especialista, já que não quer perder tempo e dinheiro com atendimentos de baixa qualidade.

**Objetivos para o cliente**

***Resolver o problema de saúde sem interrupções em sua rotina**

Claudio gostaria de tratar sua dor ao mastigar antes que se torne algo mais grave, mas sem ter que reorganizar toda sua agenda.

***Ter acesso a um atendimento de qualidade e conveniente***

Ele quer um especialista confiável, que possa resolver o problema, sem precisar passar por vários profissionais diferentes ou arriscar receber um atendimento ruim.

**Como a solução atende às necessidades de Claudio**

"Prevenir é Cuidar: Cliente Seguro, Parceiro Rentável" oferece uma solução perfeita para Claudio, pois:

***Sugere consultas preventivas no melhor horário e local*** 

Claudio não precisa se preocupar em procurar e agendar consultas. A solução sugere automaticamente um especialista qualificado, em horários que se ajustam perfeitamente à sua agenda, tornando o processo muito mais conveniente. Hoje as empresas que foram pesquisadas, possuem ótimos aplicativos, mas todos os cliente precisa procurar e agendar.

***Previne o agravamento de problemas*** 

Mesmo com sua dor ainda moderada, a solução ajuda Claudio a agir antes que o problema se torne algo mais sério, evitando procedimentos mais caros e invasivos no futuro. Se ele for a consulta, o custo hoje pode ser em torno de 120,00 (pesquisa de mercado para os valores bases de uma simples consulta). O Especilista analisa seu caso, faz uma limpeza, e percebe que é só uma inflamação que pode ser tratado com antibiótico. Se o problema continuasse e o Claudio não tivesse tomado o remédio, ele teria que retirar um dente, o que custaria para a empresa uma valor base de 2200,00.

O que é Rentável nesta situação?

***Foca em qualidade de atendimento*** 

Claudio pode confiar nos especialistas sugeridos pela plataforma, sabendo que todos têm notas altas, o que reduz o risco de uma má experiência e aumenta sua confiança no tratamento. Além dos Especilistas que vão ficar satisfeito com a Delfos Machine, por propor um novo cliente recorrente a sua carteira de clientes. Trazendo grana e cuidado da empresa com sua clinica parceira.

Sem mencionar que ambos vão ganhar no programa de benefício, que pode gerar produtos, descontos e fidelidade com a OdontoPrev.


## Etapas do projeto

Será necessário implementar seis fases no nosso projeto, para que possamos atender a demanda da OdontoPrev

**Coletar Dados do Cliente**
Utilizar o formulário de cadastro para coletar informações como localização preferida pelo cliente, avaliações de satisfação das clinicas e médicos, além dos valores de consultas com preco acessível. Na solução apresentada, se tiver qualidade, mostra que mesmo com custo baixo, a consulta pode atender a necessidade do cliente.

***O que será feito - Oracle***
Essas informações já estão no banco de dados, para coletar elas, usaremos a bilioteca do Oracle para conectar no banco e criar um dataframe.

```bash
    import oracledb
    
    # Minhas credenciais
    credencial_banco = {
        'dsn': 'oracle.fiap.com.br:1521/orcl',
        'usuario': 'rm553472',
        'senha': '100593'
    }

    # Função para conectar ao banco de dados
    def conectar(usuario, senha, dsn):
        try:
            conexao = oracledb.connect(user=usuario, password=senha, dsn=dsn, mode=oracledb.DEFAULT_AUTH)
            print("Conexão com o banco de dados Oracle estabelecida com sucesso.")
            return conexao
        except oracledb.DatabaseError as e:
            print(f"Erro ao conectar ao banco de dados: {e}")
            return None

    conexao = conectar(usuario='rm553472',senha='100593', dsn='oracle.fiap.com.br:1521/orcl')

    # Consultar dados da tabela de feedback
    query_feedback = """
    SELECT f.id_feedback, f.id_cliente, f.id_dentista, f.id_clinica, f.avaliacao, f.comentario,
        c.nome AS nome_cliente, c.sobrenome AS sobrenome_cliente,
        d.nome AS nome_dentista, d.sobrenome AS sobrenome_dentista,
        cl.nome AS nome_clinica
    FROM Feedback f
    JOIN Cliente c ON f.id_cliente = c.id_cliente
    JOIN Dentista d ON f.id_dentista = d.id_dentista
    JOIN Clinica cl ON f.id_clinica = cl.id_clinica
    """

```

***O que será feito - Pandas***
Processar Dados com Pandas: Utilizar a biblioteca Pandas para organizar e analisar os dados dos clientes, feedback, clinicas e especilistas.

```bash
    # Carregar dados em um DataFrame do Pandas
    df_feedback = pd.read_sql(query_feedback, conexao)

    # Fechar a conexão com o banco de dados
    conexao.close()

    # Selecionar as colunas necessárias para o treinamento do modelo de classificação de feedback
    df_feedback_model = df_feedback[['AVALIACAO', 'COMENTARIO']]

    # Exibir as primeiras linhas do DataFrame preparado para o modelo
    df_feedback_model.head()

    # Salvar o DataFrame preparado em um arquivo CSV para uso posterior pelo professor
    #df_feedback_model.to_csv('feedback_model_data.csv', index=False)

    df_feedback_model.info()

    df_feedback_model['AVALIACAO'] = df_feedback_model['AVALIACAO'].astype(int)
```

***O que será feito - Scikit-Learn***

Classificação com Scikit-Learn: Utilizar Scikit-Learn para classificar as clínicas e especialistas com base nas avaliações de satisfação, além de agrupar os feedbacks em categorias, sendo excelente, bons e ruins.

```bash 
    import pandas as pd
    from sklearn.model_selection import train_test_split
    from sklearn.feature_extraction.text import TfidfVectorizer
    from sklearn.ensemble import RandomForestClassifier
    from sklearn.metrics import classification_report
    from sklearn.utils import resample
    import joblib

    # Carregar os dados do arquivo CSV
    #df_feedback_model = pd.read_csv('feedback_model_data.csv')

    # Converter a coluna 'avaliacao' para o tipo inteiro
    df_feedback_model['AVALIACAO'] = df_feedback_model['AVALIACAO'].astype(int)

    # Balancear o conjunto de dados
    df_majority = df_feedback_model[df_feedback_model['AVALIACAO'] == 4]
    df_minority = df_feedback_model[df_feedback_model['AVALIACAO'] == 5]

    df_minority_upsampled = resample(df_minority, 
                                    replace=True,     # sample with replacement
                                    n_samples=len(df_majority),    # to match majority class
                                    random_state=42) # reproducible results

    df_balanced = pd.concat([df_majority, df_minority_upsampled])

    # Separar os dados em recursos (X) e rótulos (y)
    X = df_balanced['COMENTARIO']
    y = df_balanced['AVALIACAO']

    # Dividir os dados em conjuntos de treinamento e teste
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    # Vetorização dos comentários usando TF-IDF
    vectorizer = TfidfVectorizer(stop_words='english')
    X_train_tfidf = vectorizer.fit_transform(X_train)
    X_test_tfidf = vectorizer.transform(X_test)

    # Treinar o modelo de classificação usando RandomForestClassifier com ajuste de hiperparâmetros
    model = RandomForestClassifier(n_estimators=100, max_depth=10, random_state=42)
    model.fit(X_train_tfidf, y_train)

    # Fazer previsões no conjunto de teste
    y_pred = model.predict(X_test_tfidf)

    # Exibir o relatório de classificação
    print(classification_report(y_test, y_pred))

    # Salvar o modelo treinado e o vetor de palavras para uso posterior
    joblib.dump(model, 'feedback_classification_model.pkl')
    joblib.dump(vectorizer, 'tfidf_vectorizer.pkl')
``` 

***O que será feito - Flask***

Criar uma API com Flask para fornecer as sugestões de consultas ao aplicativo. Vamos realizar testes depois do modelo treinado, para saber se ele vai localizar na base comentários ruins para evitar sugestões de atendimentos ruins.

Vamos utilizar esta API para na sessão do Médico/Especialista, conste todos os feedbacks enviados para eles, mas não os que os clientes cadastraram e sim a percepção do atendimento. Um cliente pode ter dados nota 5, mas no comentário colocou que o médico não deu os devidos detalhes, neste caso, a nota não será 5 e sim um dois ou três por exemplo. O cinco pode ter sido para clinica, mas não para o médico.

```bash
    # Instalar pip install Flask joblib scikit-learn
    from flask import Flask, request, jsonify
    import joblib
    import os

    # Carregar o modelo treinado e o vetor de palavras
    model = joblib.load('feedback_classification_model.pkl')
    vectorizer = joblib.load('tfidf_vectorizer.pkl')

    app = Flask(__name__)

    @app.route('/classificar_feedback', methods=['POST'])
    def classificar_feedback():
        dados = request.json
        comentarios = [dados['COMENTARIO']]
        
        # Vetorizar o comentário
        comentarios_tfidf = vectorizer.transform(comentarios)
        
        # Fazer a previsão
        predicao = model.predict(comentarios_tfidf)
        
        return jsonify({'AVALIACAO': int(predicao[0])})

    if __name__ == '__main__':
        port = int(os.environ.get('PORT', 6001))
        app.run(debug=True, port=port)

```

**Testar com Postman**
Teste simples para ele avaliar atendimentos 4 ou 5

```bash
    http://127.0.0.1:6001/classificar_feedback
```

No body, colocar comentários como este:
```bash
    {
    "COMENTARIO": "Excelente o atendimento"
    }

```

Resposta pode vir assim:
```bash
    {
    "AVALIACAO": 5
    }
```

***O que será feito - PyTorch***

Utilizar PyTorch para treinar um modelo de IA que sugira consultas preventivas com base nos dados do cliente.

***O que será feito - Matplotlib***
Utilizar Matplotlib para criar gráficos que mostrem os custos e economias das consultas sugeridas. Essa informação ficará disponível no painel do cliente e das clínicas.

